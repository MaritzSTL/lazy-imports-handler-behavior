<!--
`lazy-imports-handler-behavior`
Pulls in the Polymer.LazyImportsBehavior and listens for an event to tell an instance of this behavior to attempt to import a lazy-group within the provided domain, if it is found then it will stop the event propagation. Listens for events on the use-capture event cycle.

@demo demo/index.html
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../lazy-imports/lazy-imports-behavior.html">

<script>

  window.mtz = window.mtz || {};

  const LazyImportsHandlerBehaviorImpl = {
    is: 'lazy-imports-handler-behavior',
    properties: {
      domain: String
    },
    ready() {
      this._importLazyGroup = this._importLazyGroup.bind(this);
    },
    attached() {
      this.addEventListener('import-lazy-group', this._importLazyGroup, true);
    },
    detached() {
      this.removeEventListener('import-lazy-group', this._importLazyGroup, true);
    },

    _importLazyGroup(event) {
      console.log('import -> this', this);
      const {detail} = event;
      if (detail && detail.group && detail.domain && this.domain === detail.domain) {
        event.stopImmediatePropagation();
        this.importLazyGroup(detail.group);
      }
    }
};

mtz.LazyImportsHandlerBehavior = [Polymer.LazyImportsBehavior, LazyImportsHandlerBehaviorImpl];

</script>
